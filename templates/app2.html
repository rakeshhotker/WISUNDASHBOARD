<!DOCTYPE html>
<html>

<head>
  <title>Wi-Sun Smart City Research Center</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css"
    integrity="sha512-hoalWLoI8r4UszCkZ5kL8vayOGVae1oxXe/2A4AO6J9+580uKHDO3JdHb7NzwwzK5xr/Fs0W40kiNHxM9vyTtQ=="
    crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"
    integrity="sha512-BB3hKbKWOc9Ez/TAwyWxNXeoV9c1v6FIeYiBieIWkpLjauysF18NzgR1MBNBXf8/KABdlkX68nAhlwcDFLGPCQ=="
    crossorigin=""></script>
  <script src="https://code.jquery.com/jquery-3.6.1.min.js"
    integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
  <script src='https://cdn.plot.ly/plotly-2.14.0.min.js'></script>
</head>
<style>
  html {
    font-family: Helvetica;
    display: inline-block;
    margin: 0px auto;
    text-align: center;
  }

  body {
    margin-top: 50px;
  }

  h1 {
    color: #444444;
    margin: 50px auto 30px;
  }

  h3 {
    color: #444444;
    margin-bottom: 50px;
  }

  .column {
    float: left;
    width: 33.33%;
  }

  .row {
    height: 15%;
  }

  .row:after {
    content: "";
    display: table;
    clear: both;
  }

  .button {
    display: block;
    width: 80px;
    background-color: #1abc9c;
    border: none;
    color: white;
    padding: 10px;
    text-decoration: none;
    font-size: 25px;
    margin: 0px auto 35px;
    cursor: pointer;
    border-radius: 4px;
    text-align: center;
  }

  #map {
    height: 600px;
    width: 700px;
    border:2px solid rgb(58, 58, 63);
  }

  .popupCustom .leaflet-popup-tip,
    .popupCustom .leaflet-popup-content-wrapper {
      background: #FFF8DC;
      opacity: 0.75;
      color: #234c5e;
      border-radius: 2px;
      transition: transform 2s ease-in-out;

    }



    .custom .leaflet-popup-close-button,
    .custom .leaflet-popup-tip-container {
      display: none;
    }

    .custom .leaflet-popup-content-wrapper,
    .custom .leaflet-popup-tip {
      background-color: transparent;
      -webkit-box-shadow: none;
      -moz-box-shadow: none;
      box-shadow: none;

    }

    .custom .leaflet-popup-content {
      font-size: 0.6rem;
      color: Black;
      font-style: italic;
    }

  .sideImages {
    width: 150px;
    height: 100px;
  }
  /* #myDiv{
    margin-top:-1%;
    margin-left:2%;
    width:500px;
    height:350px;
    border:1px solid gray;
  } */
  .myDiv{
    margin-top:15%;
  }
  #myDiv1{
    margin-left:2%;
    width:500px;
    height:350px;
    border:1px solid gray;
  }
  /* #myDiv2{
    width:500px;
    height:350px;
    border:1px solid gray;
  } */
  #myDiv3{
    width:500px;
    height:350px;
    border:1px solid gray;
  }
  .popupcontent{
    font-weight:500;
  }
  .headings{
    color:#296d8a;
  }
</style>

<body style="background-color:lightgray;font-family:'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;">
  <div style="display:flex;justify-content:space-around;align-items:flex-start;margin-left:-5%;border-bottom:2px solid gray;">
    <div>
      <img src="{{url_for('static',filename='iiith.png')}}" class="sideImages" />
      <img src="{{url_for('static',filename='logo.png')}}" class="sideImages"/>
    </div>
    <div>
      <h1 style="color:#296d8a;">Wi-SUN DEPLOYMENT<br>DASHBOARD</h1>
    </div>
    <div>
      <img src="{{url_for('static',filename='Silicon_Labs.jpg')}}" class="sideImages" />
    </div>
  </div>
  <div style="display:flex;justify-content:space-around;margin-top:-2%;">
    <div style="display:flex;flex-direction:column;justify-content:center;">
      <div>
        <div class="myDiv"><iframe style="width:500px;height:300px" src="https://smartcitylivinglab.iiit.ac.in/grafana/d-solo/kyLuJXQ7z/summary_view?orgId=3&refresh=5s&from=1661931232113&to=1662536032114&panelId=38" width="450" height="200" frameborder="0"></iframe></div>
      </div>
      <div>
        <h1 class="headings">RSSI</h1>
        <div id="myDiv1"></div>
      </div>
    </div>
    <div style="display:flex;flex-direction:column;justify-content:center;">
      <div id="map"></div>
      <div style="display:flex;flex-direction:column;justify-content:space-around;height:100px;">
       <div style="margin-top:10%;border:1px dashed black"><h1>No of Wi-SUN Nodes:&nbsp;<span style="color:green;">5</span></h1><h1>No of Active Nodes:&nbsp;<span style="color:green;">5</span></h1></div>
      </div>
    </div>
    <div style="display:flex;flex-direction:column;justify-content:center;">
      <div>
        <div class="myDiv"><iframe style="width:500px;height: 300px;" src="https://smartcitylivinglab.iiit.ac.in/grafana/d-solo/kyLuJXQ7z/summary_view?orgId=3&refresh=5s&kiosk=&from=1661931282414&to=1662536082415&panelId=53" width="450" height="200" frameborder="0"></iframe></div>
      </div>
      <div>
        <h1 class="headings">Latency</h1>
        <div id="myDiv3"></div>
      </div>
    </div>
  </div>
  <script>
    circlesObj = []
    var map = L.map("map").setView([17.445369, 78.349937], 22);
    L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 19,
      attribution: "Â© OpenStreetMap",
    }).addTo(map);
    nodes = [
      ["VindhyaA2(I)", 17.445174, 78.34997,"WN-LPO2-02"],
      ["TobeNamed", 17.445367, 78.349737,"WN-LP03-02"],
      ["VindhyaA4(I)", 17.445561, 78.349519,"WN-LP04-02"],
      ["VindhyaA4(II)", 17.44564, 78.349392,"WN-LP04-02"],
      ["VindhyaA6(I)", 17.445808, 78.349193,"WN-LP05-02"],
      ["VindhyaA6(II)", 17.445944, 78.349067,"WN-LP05-02"],
      ["PollLamp", 17.445100, 78.349947,"WN-LP01-03",],
      ["VindhyaA2(II)", 17.445041, 78.350087,"WN-LP02-02"],
      ["Pole26",17.445363,78.351186,"WN-LP06-01"],
      ["Pole25",17.445192,78.350941,"WN-LP07-01"],
      ["Pole22",17.444897,78.350772,"WN-LP08-01"],
      ["Pole21",17.444843,78.350652,"WN-LP09-01"],
      ["Pole20",17.444524,78.350334,"WN-LP10-01"],
      ["Pole19",17.444374,78.350209,"WN-LP12-01"],
      ["Pole18",17.444275,78.349894,"WN-LP12-01"],
      ["Pole59",17.445425,78.348516,"WN-LP20-01"],
      ["Pole67",17.445629,78.348365,"WN-LP21-01"],
      ["Pole78",17.446124,78.348429,"WN-LP22-01"],
      ["Pole77",17.446225,78.348707,"WN-LP23-01"],
      ["Pole80",17.446363,78.348946,"WN-LP24-01"],
      ["Pole81",17.446485,78.349105,"WN-LP25-01"],
      ["Pole83",17.446749,78.349350,"WN-LP27-01"],
      ["Pole84",17.446831,78.349501,"WN-LP28-01"],
      ["Pole38",17.446746,78.349531,"WN-LP29-01"],
      ["Pole 37",17.446648,78.349788,"WN-LP30-01"]
    ];
    var customOptions = { 'width': '600', 'className': 'popupCustom' };
    var customOptions2 = { 'className': "custom", offset: [5, 62] };
    for (let i = 0; i < nodes.length; i++) {
      var content=`<div style="display:flex;flex-direction:column;width:200px;height:fit-content"><div class="popupcontent"><strong>NodeID:&nbsp;${nodes[i][3]}</strong></div><div class="popupcontent"><strong>RSSI:&nbsp;${-72}dB</strong></div><div class="popupcontent"><strong>Latency:&nbsp;${628}ms</strong></div></div>`
      let popup = L.popup({
        closeOnclick: false,
        autoClose: false,
      }).setContent(nodes[i][0]);
      let popup2=L.popup({
        closeOnclick:false,
        autoClose:true,
      }).setContent(content);
      // labelCircle = L.circle([nodes[i][1], nodes[i][2]], {
      //   color: "#orange",
      //   fillColor: "#FFA500",
      //   fillOpacity: 0.0,
      //   radius: 4.0,
      //   offset: L.point(100, -500),
      // })
        // .bindPopup(popup, customOptions2)
        // .addTo(map)
        // .openPopup();
      circle = new L.circle([nodes[i][1], nodes[i][2]], {
        color: "#7d7b77",
        fillColor: "lightgray",
        fillOpacity: 0.7,
        radius: 2.0,
      })
        .bindPopup(popup2, customOptions)
        .addTo(map).openPopup()
      circle.on('mouseover',function(e){
        this.openPopup()
      })
      circle.on('click',function(){
        this.setStyle({fillColor:'green'})
        test(nodes[i][0])
      })
      circle.on('dblclick',function(){
        // test()
      })
      circlesObj.push(circle)
    }
    var trace1 = {
      x: [1, 2, 3, 4],
      y: [20,28,27,35],
      type: 'scatter'
    };
    var trace4={
      x:[1,2,3,4],
      y:[39,35,29,20]
    }
    var trace2 = {
      x: [-85, -80, -75, -70],
      y: [7, 3, 2, 1],
      type: 'scatter'
    };
    var trace3={
      x:[64,128,256],
      y:[0,500,1000,],
      type:'scatter'
    }
    var layout={
      paper_bgcolor:'lightgray',
      plot_bgcolor:'lightgray',
      xaxis:{
        title:{
          text:'hours'
        }
      },
      yaxis:{
        title:{
          text:'Celsius'
        }
      }
    }
    var layout1={
      paper_bgcolor:'lightgray',
      plot_bgcolor:'lightgray',
      xaxis:{
        title:{
          text:'hours'
        }
      },
      yaxis:{
        title:{
          text:'%RH'
        }
      }
    }
    var layout2={
      paper_bgcolor:'lightgray',
      plot_bgcolor:'lightgray',
      xaxis:{
        title:{
          text:'RSSI(db)'
        },
      },
      yaxis:{
        title:{
          text:'Distance'
        }
      }
    }
    var layout3={
      paper_bgcolor:'lightgray',
      plot_bgcolor:'lightgray',
      xaxis:{
        title:{
          text:'PacketSize(bytes)'
        }
      },
      yaxis:{
        title:{
          text:'microSeconds'
        }
      }
    }
    var data = [trace1];
    var data1=[trace2]
    var latencydata=[trace3]
    // Plotly.newPlot('myDiv', data,layout);
    Plotly.newPlot('myDiv1',data1,layout2);
    // Plotly.newPlot('myDiv2',[trace4],layout1);
    Plotly.newPlot('myDiv3',latencydata,layout3)

  </script>
  <script>
    let id1 = document.getElementById("node1");
    let id2 = document.getElementById("node2");
    let id3 = document.getElementById("node3");
    let id4 = document.getElementById("node4");
    let id5 = document.getElementById("node5");
    let id6 = document.getElementById("node6");
    let dim = document.getElementById("dim");
    function test(x)
    {
      console.log(x)
    }
    function Do(id) {
      let current_id = document.getElementById(id);
      if (id1 == current_id) {
        if (current_id.value == "on") {
          current_id.value = "off";
          $.ajax({
            url: "/switch?command=on&id=1",
            method: "POST",
            contentType: "application/json",
          });
          showStatus(current_id, "on");
        } else {
          current_id.value = "on";
          $.ajax({
            url: "/switch?command=off&id=1",
            method: "POST",
            contentType: "application/json",
          });
          showStatus(current_id, "off")
        }
      } else if (id2 == current_id) {
        if (current_id.value == "on") {
          current_id.value = "off";
          $.ajax({
            url: "/switch?command=on&id=2",
            method: "POST",
            contentType: "application/json",
          });
          showStatus(current_id, "on")
        } else {
          current_id.value = "on";
          $.ajax({
            url: "/switch?command=off&id=2",
            method: "POST",
            contentType: "application/json",
          });
          showStatus(current_id, "off")
        }
      } else if (id3 == current_id) {
        if (current_id.value == "on") {
          current_id.value = "off";
          $.ajax({
            url: "/switch?command=on&id=3",
            method: "GET",
            contentType: "application/json",
          });
          showStatus(current_id, "on")
        } else {
          current_id.value = "on";
          $.ajax({
            url: "/switch?command=off&id=3",
            method: "GET",
            contentType: "application/json",
          });
          showStatus(current_id, "off")
        }
      } else if (id4 == current_id) {
        if (current_id.value == "on") {
          current_id.value = "off";
          $.ajax({
            url: "/switch?command=on&id=4",
            method: "GET",
            contentType: "application/json",
          });
          showStatus(current_id, "on")
        } else {
          current_id.value = "on";
          $.ajax({
            url: "/switch?command=off&id=4",
            method: "GET",
            contentType: "application/json",
          });
          showStatus(current_id, "off")
        }
      } else if (id5 == current_id) {
        if (current_id.value == "on") {
          current_id.value = "off";
          dim.style.display = "block"
          $.ajax({
            url: "/switch?command=on&id=5",
            method: "GET",
            contentType: "application/json",
          });
          showStatus(current_id, "on")
        } else {
          current_id.value = "on";
          dim.style.display = "none"
          $.ajax({
            url: "/switch?command=off&id=5",
            method: "GET",
            contentType: "application/json",
          });
          showStatus(current_id, "off")
        }
      }
      else if (dim == current_id) {
        console.log("inin")
        $.ajax({
          url: "/switch?command=dim&id=5",
          method: "GET",
          contentType: "application/json"
        })
        showStatus(current_id, "dim")
      }
      // else if (id6 == current_id) {
      //   if (current_id.value == "on") {
      //     current_id.value = "off";
      //     $.ajax({
      //       url: "/switch?command=on&id=6",
      //       method: "POST",
      //       contentType: "application/json",
      //     })
      //   }
      //   else
      //   {
      //     current_id.value="on";
      //     $.ajax({
      //       url:"/switch?command=off&id=6",
      //       method:"POST",
      //       contentType:"application/json",
      //     })
      //   }
      // }
    }
    function showStatus(id, value) {
      if (id == id1) {
        if (value == "on") {
          console.log("in")
          circlesObj[0].setStyle({ fillColor: 'green' })
          circlesObj[7].setStyle({ fillColor: 'green' })
        }
        else if (value == "off") {
          circlesObj[0].setStyle({ fillColor: '#7d7b77' })
          circlesObj[7].setStyle({ fillColor: '#7d7b77' })
        }
      }
      else if (id == id2) {
        if (value == "on") {
          console.log("in")
          circlesObj[1].setStyle({ fillColor: 'green' })
        }
        else if (value == "off") {
          circlesObj[1].setStyle({ fillColor: '#7d7b77' })
        }
      }
      else if (id == id3) {
        if (value == "on") {
          circlesObj[2].setStyle({ fillColor: 'green' })
          circlesObj[3].setStyle({ fillColor: 'green' })
        }
        else {
          circlesObj[2].setStyle({ fillColor: '#7d7b77' })
          circlesObj[3].setStyle({ fillColor: '#7d7b77' })
        }
      }
      else if (id == id4) {
        if (value == "on") {
          circlesObj[4].setStyle({ fillColor: 'green' })
          circlesObj[5].setStyle({ fillColor: 'green' })
        }
        else {
          circlesObj[4].setStyle({ fillColor: '#7d7b77' })
          circlesObj[5].setStyle({ fillColor: '#7d7b77' })
        }
      }
      else if (id == id5) {
        if (value == "on") {
          circlesObj[6].setStyle({ fillColor: 'green' })
        }
        else {
          circlesObj[6].setStyle({ fillColor: '#7d7b77' })
        }
      }
      else if (id == dim) {
        circlesObj[6].setStyle({ fillColor: '#37a141' })
      }
    }
  </script>
  <!-- <img src="iiith.png" width="30vw" height="25vh" float="left" >
	<img src="logo.png" width="30vw" height="25vh" float="Center">
	<img src="Silicon Labs.jpg"  width="30vw" height="25vh" float="right"> -->
</body>

</html>